<?xml version="1.0" encoding="UTF-8" ?>
<odoo>
    <!--Action view duplicate VAT partner-->
    <act_window id="nca_action_res_partner_dup_button"
                name="Res Partner VAT duplicate"
                res_model="res.partner"
                domain="[('vat','=',this_vat)]"/>

    <!--Res Partner form replace old VAT-->
    <record id="base_vat.view_partner_form" model="ir.ui.view">
        <field name="arch" type="xml">
            <h1>Old VAT removed</h1>
        </field>
    </record>

    <!--Res Partner form view-->
    <record model="ir.ui.view" id="nca_view_base_form_res_partner">
        <field name="name">nca.view.base.form.res.partner</field>
        <field name="model">res.partner</field>
        <field name="inherit_id" ref="base.view_partner_form"/>
        <field name="arch" type="xml">
            <field name="company_type" position="after">
                <group colspan="2">
                    <field name="vat" string="MST / CMND" required="True" placeholder="MST / CMND"/>
                    <field name="vat_counts" invisible="True"/>
                </group>
            </field>
            <field name="company_type" position="before">
                <div name="warning_box" class="oe_right">
                    <button class="oe_stat_button"
                            name="%(nca_action_res_partner_dup_button)d"
                            type="action" icon="fa-warning"
                            string="This MST / CMND already had subscription(s)"
                            clickable="0"
                            attrs="{'invisible':[('vat_counts','=',0)]}"
                            context="{'this_vat':vat}">
                    </button>
                </div>
            </field>
            <group name="container_row_2" position="inside">
                <group name="sale" position="after">
                    <group name="sale_persons" col="2" colspan="2" string="Sale Persons" groups="sale_contract.group_sale_contract_manager,sales_team.group_sale_manager">
                        <field name="sale_man_ids" nolabel="1" colspan="2">
                            <tree>
                                <field name="name"/>
                                <field name="login"/>
                                <field name="phone"/>
                                <field name="sale_team_id"/>
                            </tree>
                        </field>
                        <field name="vat_counts" invisible="1"/>
                    </group>
                </group>
            </group>
            <field name="user_id" position="attributes">
                <attribute name="invisible">1</attribute>
            </field>
            <field name="phone" position="attributes">
                <attribute name="required">1</attribute>
            </field>
            <field name="email" position="attributes">
                <attribute name="required">1</attribute>
            </field>

            <button name="toggle_active" position="attributes">
                <attribute name="groups">sale_contract.group_sale_contract_manager,account.group_account_user</attribute>
            </button>
        </field>
    </record>

    <!--Res Partner view hidden invoiced amount and show invoiced count-->
    <record model="ir.ui.view" id="nca_view_form_button_res_partner">
        <field name="name">nca.view.form.button.res.partner</field>
        <field name="model">res.partner</field>
        <field name="inherit_id" ref="account.partner_view_buttons"/>
        <field name="arch" type="xml">
            <field name="total_invoiced" position="attributes">
                <attribute name="invisible">1</attribute>
            </field>
            <field name="total_invoiced" position="before">
                <field name="invoiced_count" widget="statinfo" nolabel="1"/>
            </field>
        </field>
    </record>

    <!--Res Partner tree view highlight duplicate-->
    <record id="nca_view_tree_res_partner_inherited" model="ir.ui.view">
        <field name="name">nca.view.tree.res.partner.inherited</field>
        <field name="model">res.partner</field>
        <field name="inherit_id" ref="base.view_partner_tree"/>
        <field name="arch" type="xml">
            <tree position="attributes">
                <attribute name="decoration-danger">vat_counts>0</attribute>
            </tree>
            <field name="email" position="after">
                <field name="vat_counts" invisible="True"/>
            </field>
            <field name="display_name" position="attributes">
                <attribute name="invisible">1</attribute>
            </field>
            <field name="display_name" position="before">
                <field name="name"/>
            </field>
            <field name="phone" position="before">
                <field name="parent_id"/>
            </field>

        </field>
    </record>

    <!--Res Partner search view add VAT-->
    <record id="nca_view_filter_res_partner_inherited" model="ir.ui.view">
        <field name="name">nca.view.filter.res.partner.inherited</field>
        <field name="model">res.partner</field>
        <field name="inherit_id" ref="base.view_res_partner_filter"/>
        <field name="arch" type="xml">
            <field name="name" position="before">
                <field name="vat"/>
            </field>
            <!--Change domain for showing company's member customer-->
            <filter name="customer" position="attributes">
                <attribute name="domain">[('customer','=',1)]</attribute>
            </filter>
            <!--Hide team member-->
            <filter name="type_company" position="after">
                <filter name="team_member" string="Teams" domain="[('user_ids','=',False)]"/>
            </filter>

        </field>
    </record>

    <!--Res Partner Kanban view replace display name-->
    <record id="nca_view_kanban_res_partner_inherited" model="ir.ui.view">
        <field name="name">nca.view.kanban.res.partner.inherited</field>
        <field name="model">res.partner</field>
        <field name="inherit_id" ref="base.res_partner_kanban_view"/>
        <field name="arch" type="xml">
            <field name="display_name" position="attributes">
                <attribute name="invisible">1</attribute>
            </field>
            <field name="display_name" position="before">
                <field name="name"/>
            </field>
            <xpath expr="//field[@name='display_name'][2]" position="attributes">
                <attribute name="invisible">1</attribute>
            </xpath>
            <xpath expr="//field[@name='display_name'][2]" position="before">
                <field name="name"/>
            </xpath>
        </field>
    </record>

    <!--New action Res Partner-->
    <record id="base.action_partner_customer_form" model="ir.actions.act_window">
        <field name="context">{'default_customer':1,"search_default_customer":1,"search_default_team_member":1}</field>
    </record>

</odoo>